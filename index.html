<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="styles.css">
  <title>Time IO</title>
</head>
<body>
  <div class="container">
    <h1>Time IO</h1>

    <div class="status-card">
      <h2>Current Status</h2>
      <p>
        <span class="idle-indicator" id="idle-indicator"></span>
        Status: <span id="idle-status">Loading...</span>
      </p>
      <p>Current Application: <span id="current-app">Loading...</span></p>
    </div>

    <div class="app-list">
      <h2>Application Usage</h2>
      <div id="app-times"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.api && typeof window.api.onStatusUpdate === 'function') {

        window.api.onStatusUpdate((data) => {

          document.getElementById('current-app').textContent = data.current_app || 'None';
          document.getElementById('idle-status').textContent = data.is_idle ? 'Idle' : 'Active';
          document.getElementById('idle-indicator').className = 'idle-indicator idle-' + data.is_idle;

          const appTimesElement = document.getElementById('app-times');
          appTimesElement.innerHTML = '';

          const sortedApps = Object.entries(data.app_times || {})
            .sort((a, b) => b[1] - a[1]);

          sortedApps.forEach(([appName, seconds]) => {
            const appElement = document.createElement('div');
            appElement.className = 'app-item';
            if (appName === data.current_app) {
              appElement.classList.add('current-app');
            }

            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const formattedTime = `${minutes}m ${remainingSeconds}s`;

            appElement.innerHTML = `
              <span>${appName}</span>
              <span>${formattedTime}</span>
            `;

            appTimesElement.appendChild(appElement);
          });
        });
      } else {
        console.error('API not available. Check preload.js configuration.');
        document.getElementById('current-app').textContent = 'API Error - Check console';
      }
    });
  </script>
</body>
</html>